# Nginx反向代理配置
# 用于管理多个Docker项目的统一入口

# 默认服务器配置
server {
    listen 80 default_server;
    server_name _;
    
    # 项目管理面板首页
    location / {
        add_header Content-Type text/html;
        return 200 '<html><head><title>Docker多项目管理中心</title><style>body{font-family:Arial;margin:40px;background:#667eea;min-height:100vh}h1{color:#fff;text-align:center}</style></head><body><h1>🐳 Docker多项目管理中心</h1><p style="color:#fff;text-align:center">欢迎使用Docker多项目管理系统</p><p style="color:#fff;text-align:center">Portainer管理: <a href="http://IP:9000" style="color:#ffd700">端口9000</a></p></body></html>';
    }
    
    # Portainer管理界面代理
    location /portainer/ {
        proxy_pass http://portainer:9000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # 健康检查端点
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
}

# 项目代理配置示例
# 为每个项目创建单独的server块或location块
# 
# 方式1：子域名代理（推荐）
# server {
#     listen 80;
#     server_name project1.yourdomain.com;
#     
#     location / {
#         proxy_pass http://project1-web:80;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
# }
#
# 方式2：路径代理
# location /project1/ {
#     proxy_pass http://project1-web:80/;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
# }